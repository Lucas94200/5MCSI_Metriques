<html>
<head>
    <meta charset="UTF-8">
    <title>Activité des Commits</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff; /* Bleu ciel */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .chart-container {
            width: 80%;
            max-width: 800px;
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <h2>Nombre de commits par heure</h2>
        <div id="chart_div"></div>
    </div>
    <script>
        google.charts.load('current', { packages: ['corechart', 'bar'] });
        google.charts.setOnLoadCallback(drawChart);

        async function drawChart() {
            // Effectuer une requête API vers l'URL GitHub
            const repoUrl = "https://api.github.com/repos/Lucas94200/5MCSI_Metriques/commits";

            try {
                const response = await fetch(repoUrl);
                if (!response.ok) {
                    throw new Error(HTTP error! Status: ${response.status});
                }

                const commitsData = await response.json();
                const results = {};

                // Traiter les données des commits
                commitsData.forEach(commit => {
                    const commitDate = commit.commit.author.date; // Date du commit
                    const dateObject = new Date(commitDate); // Conversion en objet Date
                    const hour = dateObject.getHours().toString().padStart(2, '0') + ":00"; // Heure formatée HH:00

                    results[hour] = (results[hour] || 0) + 1; // Compter les commits par heure
                });

                // Préparer les données pour Google Charts
                const dataTable = new google.visualization.DataTable();
                dataTable.addColumn('string', 'Heure');
                dataTable.addColumn('number', 'Commits');

                Object.entries(results).forEach(([hour, count]) => {
                    dataTable.addRow([hour, count]);
                });

                const options = {
                    title: 'Activité des commits par heure',
                    chartArea: { width: '70%' },
                    hAxis: { title: 'Heure', minValue: 0 },
                    vAxis: { title: 'Nombre de commits' },
                    colors: ['#000000'] /* Noir pour les barres */
                };

                const chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
                chart.draw(dataTable, options);
            } catch (error) {
                console.error("Erreur lors de la récupération des commits :", error);
            }
        }
    </script>
</body>
</html>
